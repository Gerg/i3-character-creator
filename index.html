<!--[if lt IE 9 ]> <html class="ie"> <![endif]-->
<!--[if IE 9 ]> <html class="ie ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html> <!--<![endif]-->
	<head>
		<title>Untold the Game | Character Builder</title>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
		<!-- Style sheets -->
		<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="styles/styles.css" />
		<link rel="stylesheet" type="text/css" href="styles/dialog.css" />
		<link rel="stylesheet" type="text/css" href="styles/iconic.css" />
	</head>
	<body>
		<section id="header">
			<nav id="navigation">
				<a href="#help" onClick="openDialog('help');return false;">help</a> | 
				<a href="/user/logout">logout</a>
			</nav>
			<a href="http://untoldthegame.com/"><img id="logo" src="images/logo.png" alt="Untold the Game"/></a>
			<h1>character builder</div>
		</section>
		<section id="content">
				<section class="row">
					<div id="charName">
						<h2 contenteditable>[Character Name]</h2>
					</div>
				<nav id="menu">
					<a class="navButton" href='#' onClick="newChar()">new</a>
					<a class="navButton" href='#' onClick="loadChar()">load</a>
					<a class="navButton" href='#' onClick="save()">save</a>
				</nav>
				</section>
				<section class="row">
					<section id="charInfo">
						<div id="cardImgHolder" class="border">
							<img class="card" id="cardImg" card="" src="images/unknown.png">
						</div>
						<div id="charDisc" class="border">
							<h3>Character Bio</h3>
							<p contenteditable id="charDiscTxt">
								
							</p>
						</div>
					</section>
					<div id="stats" class="border buffer">
						<table>
							<tr>
								<td> &nbsp;
								</td>
								<td>
									<img class="statsIcon" src="images/ATK.png"/> Attack
								</td>
								<td>
									<img class="statsIcon" src="images/DEF.png"/> Defense
								</td>
								<td>
									<img class="statsIcon" src="images/BOOST.png"/> Boost
								</td>
							</tr>
							<tr>
								<td>
									<img class="statsIcon" src="images/BODY.png"/> Body
								</td>
								<td id="atkBody" class="statNum body attack"></td>
								<td id="defBody" class="statNum body defense"></td>
								<td id="boostBody" class="statNum body boost"></td>
							</tr>
							<tr>
								<td>
									<img class="statsIcon" src="images/MIND.png"/> Mind
								</td>
								<td id="atkMind" class="statNum mind attack"></td>
								<td id="defMind" class="statNum mind defense"></td>
								<td id="boostMind" class="statNum mind boost"></td>
							</tr>
							<tr>
								<td>
									<img class="statsIcon" src="images/SOUL.png"/> Soul
								</td>
								<td id="atkSoul" class="statNum soul attack"></td>
								<td id="defSoul" class="statNum soul defense"></td>
								<td id="boostSoul" class="statNum soul boost"></td>
							</tr>
							<tr>
								<td>
									<img class="statsIcon" src="images/VIT.png"/> Vitality
								</td>
								<td id="vitality" class="statNum"></td>
							</tr>
						</table>
					</div>
				</section>
				<section class="row">
					<div class="pointCount border">
						<div class="pointsLabel">
							<img class="pointsIcon" src="images/UP.png"/>
							total UP
						</div>
						<div contenteditable class="pointsVal" id="pointsUP">
							0
						</div>
					</div>
					<div class="pointCount border" id="buffer-points">
						<div class="pointsLabel">
							<img class="pointsIcon" src="images/Hot_Swap.png"/>
							swap buffer
						</div>
						<div class="pointsVal" id="pointsSB">
							0
						</div>
					</div>
				</section>
				
				<!-- Overlay for when dragging a card -->
				<div id="trash-overlay" class="deckContent">
					<div class="iconic trash" id="trash-icon"></div>
				</div>
				
				
				<section class="row" id="decks">
					<div class="deck border" id="character-deck">
						<div class="deckTitle">
							Character Deck
							<button onclick="addCard('char')" class="addCard" id="add-character-card">+</button>
						</div>
						<div class="deckContent" id="charDeckContent">
							<!-- Will be added dynamically -->
						</div>
					</div>
					<div class="deck border" id="hot-swap-deck">
						<div class="deckTitle">
							Hot Swap Buffer
							<button onclick="addCard('swap')" class="addCard" id="add-hot-swap-card">+</button>
						</div>
						<div class="deckContent" id="swapDeckContent">
							<!-- Will be added dynamically -->
						</div>
					</div>
				</section>
				<section class="row">
					<div id="notes" class="border">
						<h3>Notes:</h3>
						<p contenteditable id="notesText">
						</p>
					</div>
				</section>
		<!-- </section> -->
		
		<footer>
			
			<div class="logos">
				<a href="http://www.w3.org/html/logo/"><img src="/images/ico-html5.png" alt="HTML5 Logo"/></a>
				<a href="/humans.txt"><img src="/images/ico-humanstxt.gif" alt="Humans.txt"/></a>
			</div>
			<!-- <a href="http://untoldthegame.com/"><img src="/images/logo.png" width="230px" alt="Untold The Game" /></a> -->
			
			
		</footer>	
		
	
		<!--- Templates for alert dialogs go here -->
		<!--- the ID of the script tag is how you reference the dialogs -->
		<!--- Ex: openDialog('help') opens a dialog with the content of the id="_help" tag -->
		
		
		<script type="text/template" id="_help">
			<h1>Help</h1>

			<h3>Creating a New Character</h3>
				<p>Click the ‘New’ button to create a new character. Any unsaved changes to your current character will be lost.</p>

			<h3>Saving and Loading Characters</h3>
				<p>The Untold Character Builder allows you to store multiple characters. To save a character, just click the ‘Save’ button. To load a previously saved character, click the ‘Load’ button. A list of all of your saved characters will pop up, and you can choose the character you want to load. Any unsaved changes to your current character will be lost.</p>

			<h3>Character Name, Character Bio, & Total UP</h3>
				<p>The fields for Character Name, Character Bio, and Total UP are all editable. Just click on them to modify them.</p>

			<h3>Adding Cards</h3>
				<p>To add cards to either the Character Deck or the Hot Swap Buffer, just click the plus sign. In the window that pops up, click on all of cards that you want to add and press the ‘Add’ button.</p>

			<h3>Removing Cards</h3>
				<p>To remove cards, drag them away from the deck.</p>

			<h3>Moving Cards</h3>
				<p>You can drag cards between the Character Deck and the Hot Swap Buffer.</p>

			<h3>Viewing Cards</h3>
				<p>You can double-click on any card in the Character Deck or the Hot Swap Buffer to view a large picture of the card. This also works for the picture of your character in the top left.</p>

			<h3>Notes</h3>
				<p>There is a box at the bottom of the page for you to write any notes you would like to take about your character. Using it is completely optional, but we’ve found it can be useful (for example, if your game gets interrupted for any reason). Just click on the box and enter your notes. They will be saved with your character when you click the ‘Save’ button.</p>
		</script>

		<script type="text/template" id="_saved">
			<h1>Character Saved</h1>
			<p>Your character has been saved!</p>
		</script>
		
		<script type="text/template" id="_saving">
			<h1>Saving </h1>
			<p>Please Wait</p>
			<div id="dialog-footer">...</div>
		</script>
		
		<script type="text/template" id="_load">
			<h1>Load</h1>
			<section id="loader">
				<div id="character-list-container">
					<div id="character-list">
					</div>
				</div>
				<div id="character-image-container">
					<div id="character-image">
						<img src="" alt="" />
					</div>
				</div>
			</section>
			
			<div id="dialog-footer">
				<div id="footer-left">
					<button id="delete-character" onClick="deleteChar()">Delete</button>
				</div>
				<button id="cancel-button" onClick="closeDialog()">Cancel</button>
				<button id="load-character" onClick="doLoad()">Load</button>
			</div>
		</script>

		<script type="text/template" id="_addCard">
			<h1>Add Card</h1>
			<div class="deck border" id="deck">
				<div class="deckTitle">
					Deck
				</div>
				<div class="deckContent" id="deckContent">
					<!-- Will be added dynamically -->
				</div>
			</div>
			<div class="deck border" id="hot-swap-deck-add">
				<div class="deckTitle">
					Hot Swap Buffer
				</div>
				<div class="deckContent" id="swapDeckContent-add">
					<!-- Will be added dynamically -->
				</div>
			</div>
			
			<div id="dialog-footer">
				<button id="cancel-button" onClick="closeDialog()">Cancel</button>
				<button id="add-cards" onClick="addCards()">Add</button>
			</div>
		</script>
		
		
		<script type="text/template" id="_add-cards">
			<h1>Add Cards From Deck</h1>
			<section id="adder">
				<div id="card-list-container">
					<div id="deck-cards-list">
					</div>
				</div>
				<div id="add-card-image-container">
					<div id="add-card-image">
						<img src="" alt="" />
					</div>
				</div>
			</section>
		
			<div id="dialog-footer">
				<button id="cancel-button" onClick="closeDialog()">Cancel</button>
				<button id="add-cards-to-deck" onClick="doAddCard()">Add</button>
			</div>
		</script>
		
		<script type="text/template" id="card">
			<div class="deckCard {color} card" card="{id}">
				<div class="cardCost">
					{cost}
				</div>
				<div class="cardName">
					{name}
				</div>
				<div class="swapType">
					{swap}
				</div>
			</div>
		</script>
		
		
		
		
		
		
		
		<!-- Javascript -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
		<script src="scripts/dialog.js"></script>
		<script src="scripts/builder.js"></script>
		
		<script>
		// Check that we are not pressing enter in the box and that it meets size requirements.
		$(document).delegate("#charName h2, #pointsUP","keydown",function(){
			if ( event.keyCode == 13 ){
				$(this).blur();
			}
			//Prevents the user from backspacing when the character name field is empty (if the user could, the pencil icon will drop to the next line and disappear)
			else if($(this).html().length <= 1 && event.keyCode == 8 ){
				$(this).html("&nbsp;")
			}
			// if ( ($("#charName h2").html().length > 35 && event.keyCode != 8 && event.keyCode != 46) ){
			// 	return false;
			// }
		});
		
		/******************
		 * Updaters
		 *
		 * These are used to update the values when 
		 * the user navigates away from the editable 
		 * element. 
		 ******************/
		$(document).delegate("#charName h2","blur",function(){
			character.name = $(this).html().replace("&nbsp;"," ").trim();
			character.sessionSave();
		});
		$(document).delegate("#charDiscTxt","blur",function(){
			character.description = $(this).html().trim();
			character.sessionSave();
		});
		$(document).delegate("#pointsUP", "blur", function(){
			var newValue = parseFloat($(this).html().replace("&nbsp;"," ").trim());
			if ( !isNaN(newValue) ){
				character.totalUP = newValue;
			}
			reloadUP();
		});
		$(document).delegate("#notesText", "blur", function(){
			character.notes = $(this).html().trim();
			character.sessionSave();
		});
		
		
		
		/******************
		 * Card Actions
		 *
		 * These are the events for the cards themseleves 
		 ******************/
		
		// Shows the card when it is double clicked
		$(document).delegate(".card","dblclick",function(){
			viewCard($(this).attr('card'));return false;
		})
		
		// Sets the cards to be sortable / draggable
		$(".deckContent").sortable({
			connectWith: ".deckContent",
			appendTo: "#decks",
			helper: "clone",
			start: function(event,ui){
				showTrash();
			},
			stop: function(event,ui){
				hideTrash();
				$( ".deckContent#charDeckContent" ).sortable({ disabled: false })
			},
			receive: function(event, ui) {
				$card = $(ui.item[0]);
				card = $card.data('card');
				deckId = $card.parent().attr('id');
				if ( ui.sender[0].id == 'swapDeckContent' && card.cardType == 1 ){
					for( i in character.deck ){
						/** 
						 * Because of the way jquery calls recieve, we have to 
						 * check to insure the card is not conflicting with itslef
						 */
						if ( character.deck[i].cardType == 1 && character.deck[i].id != card.id){ 
							$(ui.sender).sortable('cancel');
						}
					}
				}
			},
			update: function(event, ui) {
				updateDecks();
				hideTrash();
			},
			cursor: 'pointer',
			zIndex: 5000,
		}).disableSelection();
		
		$(".deckContent").scroll(function(e, el){
			$(this).scrollLeft(0);
		});
		
		// This sets the onclick action in the loading dialog box
		/// It shows the card preview based on the selected character.
		$(document).delegate(".loadable-character","click",function(){
			$('.loadable-character').each(function(){
				$(this).removeClass('chosen');
			})
			$this = $(this);
			$this.addClass('chosen');
			//Show image
			characterShort = $this.data('character');
			if ( characterShort ){
				if ( characterShort.image ){
					$('#character-image img').attr('src', 'http://testcb.untoldthegame.com/card_imgs/'+characterShort.image);
				}else{
					$('#character-image img').attr('src', 'images/unknown.png');
				}
			}	
		})
		
		$(document).delegate(".loadable-card", "click", function(){
			$this = $(this);
			$this.toggleClass('chosen');

			// Show image
			card = $this.data('card');
			if ( card ){
				if ( card.picture ){
					$('#add-card-image img').attr('src', 'http://testcb.untoldthegame.com/card_imgs/'+card.backpic);
				}else{
					$('#add-card-image img').attr('src', 'images/unknown.png');
				}
			}
		});

		</script>
		
	</body>
</html>
